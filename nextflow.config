manifest {
    description = 'Horn simulation and analysis pipeline'
    mainScript = 'main.nf'
}

params {
    outdir = './results'
}

profiles {
    docker {
        docker.enabled = true
        process {
            // By default, give all processes 1 CPU.
            cpus = 1

            withName: generate_geometry {
                container = 'horn-geometry:latest'
            }
            withName: run_simulation {
                container = 'horn-solver:latest'
                cpus = 2
            }
            withName: merge_results {
                container = 'horn-analysis:latest'
            }
            withName: generate_plots {
                container = 'horn-analysis:latest'
            }
            withName: extract_kpis {
                container = 'horn-analysis:latest'
            }
            withName: generate_impedance_plot {
                container = 'horn-analysis:latest'
            }
            withName: generate_phase_plot {
                container = 'horn-analysis:latest'
            }
            // Auto mode processes
            withName: prescreen_drivers {
                container = 'horn-analysis:latest'
            }
            withName: generate_auto_geometry {
                container = 'horn-geometry:latest'
            }
            withName: run_auto_simulation {
                container = 'horn-solver:latest'
                cpus = 2
            }
            withName: merge_auto_results {
                container = 'horn-analysis:latest'
            }
            withName: score_and_rank {
                container = 'horn-analysis:latest'
            }
            withName: generate_auto_report {
                container = 'horn-analysis:latest'
            }
            // Single mode extra processes
            withName: generate_dashboard {
                container = 'horn-analysis:latest'
            }
            withName: render_horn_3d {
                container = 'horn-analysis:latest'
            }
            withName: render_auto_horn_3d {
                container = 'horn-analysis:latest'
            }
            withName: run_simulation_directivity {
                container = 'horn-bem-solver:latest'
                cpus = 2
            }
            withName: merge_directivity_results {
                container = 'horn-analysis:latest'
            }
            withName: generate_directivity_plots {
                container = 'horn-analysis:latest'
            }
            withName: generate_single_report {
                container = 'horn-analysis:latest'
            }
            withName: generate_single_report_with_directivity {
                container = 'horn-analysis:latest'
            }
            // Fullauto mode processes
            withName: derive_fullauto_geometry {
                container = 'horn-analysis:latest'
            }
            withName: generate_fullauto_geometry {
                container = 'horn-geometry:latest'
            }
            withName: run_fullauto_simulation {
                container = 'horn-solver:latest'
                cpus = 2
            }
            withName: merge_fullauto_results {
                container = 'horn-analysis:latest'
            }
            withName: score_and_rank_fullauto {
                container = 'horn-analysis:latest'
            }
            withName: generate_fullauto_report {
                container = 'horn-analysis:latest'
            }
        }
    }
    standard {
        // Placeholder for local execution without Docker
    }
}
